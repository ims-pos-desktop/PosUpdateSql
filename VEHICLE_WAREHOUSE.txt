CREATE OR ALTER  VIEW [dbo].[VEHICLE_WAREHOUSE]
AS
SELECT BC, PhiscalID, DIVISION, WAREHOUSE FROM
(
	SELECT MCODE, P.PhiscalID, P.DIVISION,  BC, P.WAREHOUSE, REALQTY_IN, RealQty FROM RMD_TRNPROD P JOIN RMD_WAREHOUSE W ON P.WAREHOUSE = W.NAME WHERE W.ISVIRTUAL = 0 AND W.ISDELWARE = 0
	union all
	SELECT MCODE, P.PhiscalID, P.DIVISION, BC, P.WAREHOUSE, REALQTY_IN, RealQty FROM GRNPROD P JOIN RMD_WAREHOUSE W ON P.WAREHOUSE = W.NAME WHERE W.ISVIRTUAL = 0 AND W.ISDELWARE = 0
)P JOIN MENUITEM MI ON P.MCODE = MI.MCODE
WHERE MI.PTYPE = 4
GROUP BY BC, WAREHOUSE, PhiscalID, DIVISION
HAVING SUM(REALQTY_IN - REALQTY) > 0