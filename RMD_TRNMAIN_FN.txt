CREATE OR ALTER FUNCTION [dbo].[RMD_TRNMAIN_FN] (@GRNWISE TINYINT, @PhiscalId VARCHAR(25) = '%')
RETURNS @RMD_TRNMAIN TABLE (VCHRNO varchar(25) NOT NULL, DIVISION char(3) NOT NULL, CHALANNO varchar(50), TRNDATE smalldatetime NULL, BSDATE varchar(10),
TRNTIME varchar(15), TOTAMNT numeric(22, 12), DCAMNT numeric(22, 12), DCRATE numeric(22, 12), VATAMNT numeric(22, 12),
NETAMNT numeric(22, 12), ADVANCE numeric(22, 12), TRNMODE varchar(50), BILLTO varchar(100), BILLTOADD varchar(500),
TRNUSER varchar(25), VATBILL tinyint, DELIVERYDATE smalldatetime NULL, DELIVERYTIME varchar(15), ORDERS varchar(25),
REFORDBILL varchar(50), INDDIS tinyint, CREBATE numeric(22, 12), CREDIT tinyint, DUEDATE datetime NULL, TRNAC varchar(25),
PARAC varchar(25), PARTRNAMNT numeric(22, 12), RETTO varchar(255), REFBILL varchar(250), CHEQUENO varchar(25),
CHEQUEDATE datetime NULL, REMARKS nvarchar(500), POST tinyint, POSTUSER varchar(50), FPOSTUSER varchar(50), TERMINAL char(3),
[SHIFT] varchar(25), EXPORT tinyint, CHOLDER varchar(50), CARDNO varchar(50), EditUser varchar(50), MEMBERNO varchar(50),
MEMBERNAME varchar(250), EDITED smallint NULL, TAXABLE numeric(22, 12), NONTAXABLE numeric(22, 12), VMODE tinyint,
BILLTOTEL varchar(50), BILLTOMOB varchar(50), TRN_DATE datetime NULL, BS_DATE varchar(50), STAX numeric(22, 12), TOTALCASH numeric(22, 12),
TOTALCREDIT numeric(22, 12), TOTALCREDITCARD numeric(22, 12), TOTALGIFTVOUCHER numeric(22, 12), TENDER numeric(30, 12), CHANGE numeric(30, 12),
CardTranID varchar(20), ReturnVchrID varchar(20), TranID numeric(18, 0), VoucherStatus varchar(200), VoucherType varchar(2) NOT NULL,
PRESCRIBEBY varchar(100), DISPENSEBY varchar(50), RECEIVEBY varchar(50), Edate datetime NULL, [STATUS] tinyint, CONFIRMEDBY varchar(50),
CONFIRMEDTIME varchar(25), PhiscalID varchar(20) NOT NULL, Stamp float NULL, ROUNDOFF numeric(22, 12), Customer_Count numeric(22, 12), DBUSER varchar(50),
HOSTID varchar(25), VNUM varchar(25), TOTALREBATE numeric(22, 12), DISVALUE numeric(22, 12), STAXVALUE numeric(22, 12), COSTCENTER varchar(100),
TOTALFLATDISCOUNT numeric(22, 12), TOTALINDDISCOUNT numeric(22, 12), TOTALLOYALTY numeric(22, 12), TOTALPROMOTION numeric(22, 12), NETWITHOUTROUNDOFF numeric(22, 12),
guid varchar(100), JOBNO varchar(50), MWAREHOUSE varchar(50), POSTID varchar(20), PRIMARY KEY CLUSTERED (VCHRNO, DIVISION, PHISCALID))
AS
BEGIN
INSERT INTO @RMD_TRNMAIN
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.ABBMAIN	WHERE PhiscalId	LIKE @PhiscalId

UNION ALL
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.TRNMAIN WHERE PhiscalId	LIKE @PhiscalId  

UNION ALL
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.ACCMAIN	WHERE PhiscalId	LIKE @PhiscalId

UNION ALL
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.INVMAIN	WHERE PhiscalId	LIKE @PhiscalId

UNION ALL
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.PURMAIN WHERE PhiscalId	LIKE @PhiscalId
                          
UNION ALL
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.GRNMAIN WHERE VoucherType = 'GR' AND @GRNWISE = 1 AND PhiscalId	LIKE @PhiscalId

UNION ALL
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.AOPMAIN WHERE PhiscalId	LIKE @PhiscalId	 

UNION ALL
SELECT  VCHRNO, DIVISION, CHALANNO, TRNDATE, BSDATE, TRNTIME, TOTAMNT, DCAMNT, DCRATE, VATAMNT, NETAMNT, ADVANCE, TRNMODE, BILLTO, BILLTOADD, TRNUSER, VATBILL, DELIVERYDATE, 
DELIVERYTIME, ORDERS, REFORDBILL, INDDIS, CREBATE, CREDIT, DUEDATE, TRNAC, PARAC, PARTRNAMNT, RETTO, REFBILL, CHEQUENO, CHEQUEDATE, REMARKS, POST, POSTUSER, FPOSTUSER, 
TERMINAL, SHIFT, EXPORT, CHOLDER, CARDNO, EditUser, MEMBERNO, MEMBERNAME, EDITED, TAXABLE, NONTAXABLE, VMODE, BILLTOTEL, BILLTOMOB, TRN_DATE, BS_DATE, STAX, TOTALCASH, 
TOTALCREDIT, TOTALCREDITCARD, TOTALGIFTVOUCHER, TENDER, CHANGE, CardTranID, ReturnVchrID, TranID, VoucherStatus, VoucherType, PRESCRIBEBY, DISPENSEBY, RECEIVEBY, Edate, STATUS, 
CONFIRMEDBY, CONFIRMEDTIME, PhiscalID, Stamp, ROUNDOFF, Customer_Count, DBUSER, HOSTID, VNUM, TOTALREBATE, DISVALUE, STAXVALUE, COSTCENTER, TOTALFLATDISCOUNT, TOTALINDDISCOUNT, 
TOTALLOYALTY, TOTALPROMOTION, NETWITHOUTROUNDOFF, guid, JOBNO, MWAREHOUSE, POSTID
FROM    dbo.OPMAIN WHERE PhiscalId	LIKE @PhiscalId	 
RETURN
END