IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'RMD_Order_AdditionalDetail')
CREATE TABLE [dbo].[RMD_Order_AdditionalDetail](
	[VCHRNO] [varchar](25) NOT NULL,
	[DIVISION] [char](3) NOT NULL,
	[MCODE] [varchar](25) NOT NULL,
	[PhiscalID] [varchar](20) NOT NULL,
	[ITEMDESC] [varchar](200) NULL,
	[Flavour] [varchar](200) NULL,
	[Design] [varchar](200) NULL,
	[Shape] [varchar](200) NULL,
	[Weight] [varchar](200) NULL,
	[CakeMessage] [NVARCHAR](500) NULL,
	[SNO] INT NOT NULL,
	CONSTRAINT PK_RMD_Order_AdditionalDetail PRIMARY KEY (VCHRNO, SNO),
	CONSTRAINT  FK_RMD_Order_AdditionalDetail_OrderMain FOREIGN KEY (VCHRNO, DIVISION, PhiscalID) REFERENCES RMD_ORDERMAIN (VCHRNO, DIVISION, PhiscalID),
	CONSTRAINT  FK_RMD_Order_AdditionalDetail_MenuItem FOREIGN KEY (MCODE) REFERENCES MENUITEM (MCODE),
) ON [PRIMARY]


IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'RMD_Order_AdditionalDetail' AND COLUMN_NAME = 'CakeMessage')
ALTER TABLE RMD_Order_AdditionalDetail ADD [CakeMessage] [NVARCHAR](500) NULL

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'RMD_Order_AdditionalDetail' AND COLUMN_NAME = 'SNO' AND IS_NULLABLE = 'YES')
ALTER TABLE RMD_Order_AdditionalDetail ALTER COLUMN SNO INT NOT NULL

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'RMD_Order_AdditionalDetail' AND COLUMN_NAME = 'DIVISION' AND IS_NULLABLE = 'YES')
ALTER TABLE RMD_Order_AdditionalDetail ALTER COLUMN DIVISION CHAR(3) NOT NULL

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'RMD_Order_AdditionalDetail' AND COLUMN_NAME = 'MCODE' AND IS_NULLABLE = 'YES')
ALTER TABLE RMD_Order_AdditionalDetail ALTER COLUMN MCODE VARCHAR(25) NOT NULL

IF OBJECT_ID('PK_RMD_Order_AdditionalDetail')  IS NULL
ALTER TABLE RMD_Order_AdditionalDetail ADD CONSTRAINT PK_RMD_Order_AdditionalDetail PRIMARY KEY (VCHRNO, SNO) 

IF OBJECT_ID('FK_RMD_Order_AdditionalDetail_OrderMain')  IS NULL
ALTER TABLE RMD_Order_AdditionalDetail ADD CONSTRAINT  FK_RMD_Order_AdditionalDetail_OrderMain FOREIGN KEY (VCHRNO, DIVISION, PhiscalID) REFERENCES RMD_ORDERMAIN (VCHRNO, DIVISION, PhiscalID)

IF OBJECT_ID('FK_RMD_Order_AdditionalDetail_MenuItem')  IS NULL
ALTER TABLE RMD_Order_AdditionalDetail ADD CONSTRAINT  FK_RMD_Order_AdditionalDetail_MenuItem FOREIGN KEY (MCODE) REFERENCES MENUITEM (MCODE)

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'RMD_Order_AdditionalDetail' AND COLUMN_NAME = 'CakeMessage')
ALTER TABLE RMD_Order_AdditionalDetail ADD CakeMessage NVARCHAR(500) NULL

