CREATE OR ALTER PROCEDURE OSP_ExportBranchTransferOut
@VCHRNO VARCHAR(50)
AS

BEGIN TRANSACTION
	DELETE FROM RMD_TRNMAINS WHERE VCHRNO = @VCHRNO

	INSERT INTO RMD_TRNMAINS(VCHRNO,DIVISION,CHALANNO,TRNDATE,BSDATE,TRN_DATE,BS_DATE ,TRNTIME,TOTAMNT,NETAMNT,TRNMODE,BILLTO,BILLTOADD,TRNUSER,REMARKS,TERMINAL,PhiscalID,EditUser, REFBILL, Stamp)
	SELECT VCHRNO,DIVISION,CHALANNO,TRNDATE,BSDATE,TRN_DATE,BS_DATE ,TRNTIME,TOTAMNT,NETAMNT,TRNMODE,BILLTO,BILLTOADD,TRNUSER,REMARKS,TERMINAL,PhiscalID,EditUser, REFBILL, Stamp
	FROM INVMAIN WHERE VCHRNO =@VCHRNO

	INSERT INTO RMD_TRNPRODS(VCHRNO,CHALANNO,DIVISION, MCODE,UNIT,Quantity,RealQty, AltQty,RATE, CRATE, AMOUNT, REALRATE, ALTRATE,REALQTY_IN,ALTQTY_IN ,WAREHOUSE,PRATE,SNO,BC, ALTUNIT,PhiscalID ,STAMP, Batch, VAT)
	SELECT VCHRNO,CHALANNO,DIVISION, MCODE,UNIT,Quantity,RealQty, AltQty,RATE, CRATE, AMOUNT,REALRATE, ALTRATE, REALQTY_IN,ALTQTY_IN ,WAREHOUSE,PRATE,SNO,BC, ALTUNIT,PhiscalID ,STAMP, Batch, VAT
	FROM INVPROD WHERE VCHRNO =@VCHRNO AND ADDTIONALROW = 0
COMMIT TRANSACTION