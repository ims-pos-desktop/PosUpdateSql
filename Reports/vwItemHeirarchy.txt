
CREATE OR ALTER VIEW [dbo].[vwItemHeirarchy]
AS
SELECT MI.MCODE, MG.DESCA [Main Group], NULL [Main Category], NULL [Sub Category], NULL [Super Category] FROM MENUITEM MI 
JOIN MENUITEM MG ON MI.PARENT = MG.MCODE
WHERE MG.PARENT = 'MI' AND MI.TYPE = 'A'
UNION ALL
SELECT MI.MCODE, MG.DESCA, MC.DESCA, NULL, NULL  FROM MENUITEM MI
JOIN MENUITEM MC  ON MI.PARENT = MC.MCODE 
JOIN MENUITEM MG ON MC.PARENT = MG.MCODE
WHERE MG.PARENT = 'MI' AND MI.TYPE = 'A'
UNION ALL
SELECT MI.MCODE, MG.DESCA, MC.DESCA, SC.DESCA, NULL FROM MENUITEM MI 
JOIN MENUITEM SC ON MI.PARENT = SC.MCODE 
JOIN MENUITEM MC  ON SC.PARENT = MC.MCODE 
JOIN MENUITEM MG ON MC.PARENT = MG.MCODE
WHERE MG.PARENT = 'MI' AND MI.TYPE = 'A'
UNION ALL
SELECT MI.MCODE, MG.DESCA, MC.DESCA, SC.DESCA, SS.DESCA FROM MENUITEM MI 
JOIN MENUITEM SS ON MI.PARENT = SS.MCODE 
JOIN MENUITEM SC ON SS.PARENT = SC.MCODE 
JOIN MENUITEM MC  ON SC.PARENT = MC.MCODE 
JOIN MENUITEM MG ON MC.PARENT = MG.MCODE
WHERE MG.PARENT = 'MI' AND MI.TYPE = 'A'