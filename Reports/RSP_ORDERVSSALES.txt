
CREATE OR ALTER PROC RSP_ORDERVSSALES
@DATE1 DATETIME,
@DATE2 DATETIME,
@DIVISION VARCHAR(3) = '%',
@CUSTOMER_ACID VARCHAR(25) = '%'
AS
SELECT OM.CHALANNO, OM.REFNO, MI.DESCA, OP.QUANTITY PO_QTY, OP.RATE, OP.AMOUNT, TM.INV_QTY, TM.INV_AMOUNT, OP.QUANTITY - ISNULL(TM.INV_QTY, 0) REM_QTY, OP.AMOUNT  - ISNULL(TM.INV_AMOUNT, 0) REM_AMOUNT FROM RMD_ORDERMAIN OM JOIN RMD_ORDERPROD OP ON OM.VCHRNO = OP.VCHRNO
JOIN MENUITEM MI ON OP.MCODE = MI.MCODE
LEFT JOIN 
( 
	SELECT TM.VCHRNO, TM.REFORDBILL, TP.MCODE, SUM(TP.QUANTITY) INV_QTY, SUM(TP.AMOUNT) INV_AMOUNT FROM  RMD_TRNMAIN TM
	JOIN RMD_TRNPROD TP ON TM.VCHRNO = TP.VCHRNO 
	GROUP BY TM.VCHRNO, TM.REFORDBILL, TP.MCODE
) TM ON TM.REFORDBILL = OM.VCHRNO AND TM.MCODE = OP.MCODE
WHERE OM.TRNDATE BETWEEN @DATE1 AND @DATE2 AND OM.DIVISION LIKE @DIVISION AND OM.TRNAC LIKE @CUSTOMER_ACID

