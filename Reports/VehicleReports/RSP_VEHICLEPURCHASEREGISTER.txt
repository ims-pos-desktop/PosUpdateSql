CREATE OR ALTER   PROC [dbo].[RSP_VEHICLEPURCHASEREGISTER]
@DATE1 AS DATETIME,
@DATE2 AS DATETIME,
@TERMINAL AS VARCHAR(25) = '%'
AS
--SET @DATE1 = '07-17-2018'
--SET @DATE2 = '07-16-2019'
(
SELECT DBO.GETNEPALIMONTH(SUBSTRING(BSDATE, 4, 2)) AS MONTH,A.VCHRNO AS PURCHASE_VCHR,A.CHALANNO AS PURCHASE_BILL ,A.TRNDATE AS DATE,A.BSDATE AS MITI,B.RATE AS GROSS_AMT,
B.DISCOUNT AS DIS_AMT,CASE WHEN A.VCHRNO LIKE 'OP%'THEN CONVERT(DECIMAL(10,2),(B.RATE -B.DISCOUNT+ B.VAT))ELSE
CONVERT(DECIMAL(10,2),(B.RATE -B.DISCOUNT+ B.VAT)/1.13) END AS TAXABLE_AMT,CONVERT(DECIMAL(10,2),B.VAT) AS VAT_AMT,CONVERT(DECIMAL(10,2),(B.RATE -B.DISCOUNT+ B.VAT)) AS NET_AMT, E.ACNAME AS AC_LEDGER, A.BILLTOADD AS PAN_NO,D.CUSTNAME AS CUSTOMER_NAME, A.BILLTOTEL
AS ADDRESS, C.VEHICLEENGINENO AS ENGINENO, C.VEHICLECHASISNO, AA.DESCA AS ITEM_NAME,C.VEHICLEMODEL, C.VEHICLEREGISTRATIONNO, C.COLOR,A.REMARKS,B.SNO AS SERIAL_NO FROM RMD_TRNMAIN A 
INNER JOIN RMD_TRNPROD B ON A.VCHRNO = B.VCHRNO 
LEFT JOIN BARCODE_DETAIL C ON   B.BC = C.BARCODE  
--LEFT JOIN CustomerProfile D ON  D.CUSTID = C.CUSTID 
LEFT JOIN 
(
	SELECT M.BILLTO CUSTNAME, P.BC FROM RMD_TRNMAIN M JOIN RMD_TRNPROD P ON M.VCHRNO = P.VCHRNO JOIN MENUITEM MI ON P.MCODE = MI.MCODE WHERE LEFT(M.VCHRNO, 2) IN ('TI') AND MI.PTYPE = 4
) D ON D.BC = C.BARCODE
LEFT JOIN  RMD_ACLIST E ON E.ACID = A.TRNAC 
LEFT JOIN MENUITEM AA ON B.MCODE = AA.MCODE 
WHERE LEFT (A.VCHRNO,2) IN ('PI','OP')  AND C.VEHICLECHASISNO IS NOT NULL AND AA.PTYPE = 4
AND A.TRNDATE  BETWEEN @DATE1 AND @DATE2) ORDER BY ( CAST(SUBSTRING(A.VNUM,3,LEN(A.VCHRNO)) AS NUMERIC))



