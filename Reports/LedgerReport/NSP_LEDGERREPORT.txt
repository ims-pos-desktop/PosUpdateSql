CREATE OR ALTER PROCEDURE [dbo].[NSP_LEDGERREPORT]
--Declare
	@ACID AS VARCHAR(500),
	@DATE1 AS DATETIME,
	@DATE2 AS DATETIME,
	@DIV VARCHAR(15)='%',
	@CostCenter Varchar(500)='',
	@showNdate tinyint = 0,
	@InSingleLedger tinyint=0,	
	@IsAccountLedger tinyint=0,
	@REPORTBYCOSTCENTER TINYINT = 0,
	@HASMULTILEDGER TINYINT = 1,
	@SHOWPRODUCTDETAIL TINYINT = 1,
	@SUMMARYREPORT TINYINT = 0,
	@FCURRENCY TINYINT=0,
	@FYID VARCHAR(10) = '%'
AS

IF @FCURRENCY=1
	IF @SUMMARYREPORT = 1
		EXEC NSP_LEDGERREPORT_SUMMARY_FCURRENCY @ACID,@DATE1, @DATE2, @DIV,@CostCenter,@showNdate,@InSingleLedger, @IsAccountLedger,@REPORTBYCOSTCENTER,@HASMULTILEDGER,@SHOWPRODUCTDETAIL, @FYID
	ELSE
		EXEC NSP_LEDGERREPORT_DETAIL_FCURRENCY @ACID,@DATE1,	@DATE2,	@DIV,@CostCenter,@showNdate,@InSingleLedger, @IsAccountLedger,@REPORTBYCOSTCENTER,@HASMULTILEDGER,@SHOWPRODUCTDETAIL, @FYID
ELSE
BEGIN
	set nocount on 

	--SEt @Acid ='LB01003';set @date1='2020-07-16';set @date2='2021-07-16';set @div='%';SEt @CostCenter='';set @InSingleLedger=0;
	--SEt @IsAccountLedger=1

	--TEMPORARY TABLE DECLARATION
	-----------------------------

	DECLARE @LedgerTable table(Sno numeric,trndate datetime,bsdate varchar(50),vchrno varchar(50),chalanno varchar(50),refbill varchar(25),refordbill varchar(25), trntime varchar(10), particulars varchar(2000),
		Dramnt numeric(24,10),Cramnt numeric(24,10),naration VARCHAR(2500),B_acid varchar(50),division varchar(20),Balance numeric(24,10),A_acid varchar(50),Ccenter varchar(100), Rmk VARCHAR(2500),stamp numeric(32,18),Cheque varchar(100))

	DECLARE @LedgerTable_tmp table(Sno numeric,trndate datetime,bsdate varchar(30),vchrno varchar(50),chalanno varchar(50),refbill varchar(25),refordbill varchar(25), trntime varchar(10),particulars varchar(2000),
		Dramnt numeric(24,10),Cramnt numeric(24,10),naration VARCHAR(2500),B_acid varchar(50),division varchar(20),Balance numeric(24,10),A_acid varchar(50),Ccenter varchar(100), Rmk VARCHAR(2500),stamp numeric(32,18),Cheque varchar(100))

	--DECLARING VARIABLES
	---------------------
	Declare @Sno numeric,@A_Acid varchar(50),@Dramnt numeric(24,10),@Cramnt numeric(24,10),@RunningTotal numeric(24,10)=0,
	@A_Acid_Tmp varchar(50)='',@trndate datetime,@Bsdate varchar(50),@vchrno varchar(50),@Chalanno varchar(50),@particulars varchar(2500),@naration VARCHAR(1500),
	@B_acid varchar(50),@division varchar(20),@CCenter varchar(100), @Rmk VARCHAR(1500),@stamp numeric(32,18),@CHEQUE varchar(100)

	DECLARE @AcLookup TABLE (ACID VARCHAR(25), ACNAME VARCHAR(100))

	IF @InSingleLedger = 1
	INSERT INTO @AcLookup VALUES ('AT','AT')

	IF @REPORTBYCOSTCENTER = 0
		INSERT INTO @AcLookup
		SELECT ACID, ACNAME FROM RMD_ACLIST WHERE ACID IN (select * from dbo.Split(@acid,','))
	ELSE 
		INSERT INTO @AcLookup
		SELECT CostCenterName, CostCenterName FROM CostCenter WHERE CostCenterName IN (SELECT * FROM dbo.SPLIT(@COSTCENTER,','))


	if @div='' set @div='%'
	BEGIN
	--IF @InSingleLedger=0 
		BEGIN
			--IF @REPORTBYCOSTCENTER = 0
				Insert into @LedgerTable_tmp
				SELECT  ROW_NUMBER() over(PARTITION by IIF(@REPORTBYCOSTCENTER = 0, A_ACID, COSTCENTER) ORDER BY TRNDATE, VCHRNO) as SNo, TRNDATE, BSDATE, VCHRNO, CHALANNO, REFBILL, REFORDBILL, TRNTIME, PARTICULARS,DRAMNT,CRAMNT,
				CASE WHEN CHARINDEX(CHAR(10),NARATION,0) >0 THEN LEFT(NARATION,LEN(NARATION)-2) ELSE NARATION END as NARATION, 
				B_ACID,DIVISION,DRAMNT-CRAMNT AS BALANCE,A_ACID,COSTCENTER,REMARKS,STAMP,CHEQUE
				FROM
				(
					--MAIN REPORT QUERY
					--------------------		
					SELECT NULL AS TRNDATE, NULL AS BSDATE, NULL AS VCHRNO, NULL AS CHALANNO,NULL REFBILL,NULL REFORDBILL, NULL TRNTIME, 'OPENING BALANCE' AS PARTICULARS,
					CASE WHEN(x.OPBAL >=0) THEN x.OPBAL ELSE 0 END AS DRAMNT, CASE WHEN(x.OPBAL<0) THEN x.OPBAL * -1 ELSE 0 END AS CRAMNT,'' AS NARATION,NULL AS DIVISION,
					y.acid as A_acid, '' B_ACID, y.ACID COSTCENTER,NULL REMARKS,0 STAMP,NULL CHEQUE
					FROM
					(
						SELECT IIF(@InSingleLedger = 1, 'AT', a.A_ACID) A_ACID, IIF(@REPORTBYCOSTCENTER = 1, ISNULL(A.COSTCENTER,''), 'AT') COSTCENTER,sum(DRAMNT)-SUM(CRAMNT) AS OPBAL FROM RMD_TRNTRAN A WITH (NOLOCK) 
						INNER JOIN RMD_TRNMAIN B WITH (NOLOCK) ON A.VCHRNO = B.VCHRNO AND A.DIVISION = B.DIVISION 
						WHERE A.A_ACID IN (select * from dbo.split(@acid,',')) AND B.DIVISION LIKE @DIV AND B.PhiscalID = @FYID AND
						(LEFT(A.VCHRNO,2) = 'OB' OR B.TRNDATE < @DATE1) AND ((@COSTCENTER='' and isnull(A.CostCenter,'') like '%') or (@COSTCENTER <> '' and  A.CostCenter IN (SELECT * FROM dbo.SPLIT(@COSTCENTER,','))))
						group by IIF(@InSingleLedger = 1, 'AT', a.A_ACID), IIF(@REPORTBYCOSTCENTER = 1, ISNULL(A.COSTCENTER,''), 'AT')
					) as X right join @AcLookup Y on IIF(@REPORTBYCOSTCENTER = 0, x.A_ACID, x.COSTCENTER)=Y.acid
					
					UNION ALL
									
					SELECT M.TRNDATE, M.BSDATE,  M.VCHRNO, M.CHALANNO, M.REFBILL, M.REFORDBILL, M.TRNTIME,
					dbo.GetParticularForLedger(M.VCHRNO,M.DIVISION)  AS PARTICULAR, CONVERT(NUMERIC(18,2),M.DRAMNT) AS DRAMNT,
					CONVERT(NUMERIC(18,2),M.CRAMNT) AS CRAMNT, M.NARATION, M.DIVISION,A_ACID, M.B_ACID, M.COSTCENTER,
					CASE WHEN M.NARATION = M.REMARKS THEN '' ELSE M.REMARKS END REMARKS,STAMP,CASE WHEN ISNULL(M.CHEQUENO,'') <> '' THEN ' Chq. No : ' + CAST(M.ChequeNo AS VARCHAR(25)) +  '  Dt : ' +  CAST(m.chequedate AS VARCHAR(25)) ELSE '' END AS CHEQUE
					FROM
					(
						SELECT B.TRNDATE,B.BSDATE,B.VCHRNO, B.CHALANNO, B.REFBILL, B.REFORDBILL, B.TRNTIME, A.DIVISION, IIF(@InSingleLedger = 0, A.A_ACID, 'AT') A_ACID, IIF(@SUMMARYREPORT = 0, A.B_ACID,'') B_ACID,
						SUM(DRAMNT) AS DRAMNT, SUM(CRAMNT) AS CRAMNT, case when isnull(NARATION1,'')='' then NARATION ELSE NARATION1 END  AS NARATION,IIF(@InSingleLedger = 0, A.COSTCENTER, 'AT') COSTCENTER,ISNULL(B.REMARKS,'')REMARKS,
						ISNULL(B.STAMP,convert(float,convert(datetime,B.TRNDATE + ' ' + ISNULL(B.TRNTIME,'00:01:00')))) STAMP,ISNULL(A.CHEQUENO,'') CHEQUENO,ISNULL(A.CHEQUEDATE,'') CHEQUEDATE from 
						RMD_TRNTRAN A WITH (NOLOCK) INNER JOIN RMD_TRNMAIN B WITH (NOLOCK) ON A.VCHRNO=B.VCHRNO AND A.DIVISION=B.DIVISION 
						WHERE A_ACID IN (select * from dbo.split(@acid,',')) 
						AND B.DIVISION LIKE @DIV 
						AND B.PhiscalID = @FYID  
						AND (B.TRNDATE >= @DATE1 
						AND B.TRNDATE <= @DATE2)
						AND A.VCHRNO NOT LIKE 'OB%' 
						and ((@COSTCENTER='' AND isnull(A.CostCenter,'') LIKE '%') OR (@COSTCENTER <> '' 
						AND A.CostCenter IN (SELECT * FROM dbo.SPLIT(@COSTCENTER,','))))
						GROUP BY B.VCHRNO,B.CHALANNO,B.REFBILL, B.REFORDBILL, B.TRNTIME, A.DIVISION, A.A_ACID, 
						IIF(@SUMMARYREPORT = 0, A.B_ACID,''), case when isnull(NARATION1,'')='' then NARATION ELSE NARATION1 END,
						B.REMARKS,B.TRNDATE,B.BSDATE,A.COSTCENTER,ISNULL(A.CHEQUENO,''),ISNULL(A.CHEQUEDATE,''),
						ISNULL(B.STAMP,convert(float,convert(datetime,B.TRNDATE + ' ' + ISNULL(B.TRNTIME,'00:01:00')))) 
					) AS M
				)A
		END
	END
	--SELECT * FROM @LedgerTable_tmp

	--PREPARING RECORD WITH RUNNING TOTAL
	-------------------------------------
	if @REPORTBYCOSTCENTER = 0
		INSERT INTO @LedgerTable SELECT SNO, TRNDATE, BSDATE, VCHRNO, CHALANNO, REFBILL, REFORDBILL, trntime, PARTICULARS, DRAMNT, CRAMNT, NARATION, B_ACID, DIVISION, SUM(DRAMNT-CRAMNT) OVER (PARTITION BY A_ACID ORDER BY SNO), A_ACID, CCENTER, RMK, STAMP, CHEQUE FROM @Ledgertable_tmp
	else
		INSERT INTO @LedgerTable SELECT SNO, TRNDATE, BSDATE, VCHRNO, CHALANNO, REFBILL, REFORDBILL, trntime, PARTICULARS, DRAMNT, CRAMNT, NARATION, B_ACID, DIVISION, SUM(DRAMNT-CRAMNT) OVER (PARTITION BY CCENTER ORDER BY SNO), A_ACID, CCENTER, RMK, STAMP, CHEQUE FROM @Ledgertable_tmp
	
	--select * from @LedgerTable order by a_acid,sno
	--select * from @LedgerTable order by ccenter,sno

	--PREPARING REPORT OUTPUT
	--------------------------
	SELECT [DATE], MITI,VNO,REFBILL,REFORDBILL, trntime, PARTICULAR, VTYPE, CONVERT(VARCHAR,CAST(DRAMNT AS MONEY),1) DRAMNT,CONVERT(VARCHAR,CAST(CRAMNT AS MONEY),1) CRAMNT,BALANCE,B_ACID,DIVISION,XSNO,NULL CCENTER FROM 
	(
		--ACCOUNT NAME

		SELECT 0 SNO,NULL AS [DATE],NULL MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME, 'A/C : ' + UPPER(Y.ACNAME)  AS PARTICULAR, NULL VTYPE, NULL AS DRAMNT,NULL AS CRAMNT,NULL BALANCE,
		NULL B_ACID,NULL AS DIVISION,NULL AS ORD,0 STAMP,A_acid,5 XSNO, NULL CCENTER 
		FROM @LedgerTable X INNER JOIN RMD_ACLIST Y ON X.A_ACID = Y.ACID WHERE @InSingleLedger = 0 GROUP BY A_ACID,Y.ACNAME
			
		UNION ALL		

		--DETAIL PART
		SELECT A.SNO,CONVERT(VARCHAR(25),A.TRNDATE,105) [DATE], A.BSDATE ,
		IIF(UPPER(A.PARTICULARS) = 'OPENING BALANCE', '',
			A.VCHRNO + IIF(A.chalanno <> '' AND A.chalanno <> A.VCHRNO, ' (' + A.CHALANNO + ')', '')) VNO
		,ISNULL(A.REFBILL,'') REFBILL, ISNULL(A.REFORDBILL,'') REFORDBILL, ISNULL(A.TRNTIME, '') TRNTIME
		,IIF(@SUMMARYREPORT = 0 AND UPPER(A.PARTICULARS) <> 'OPENING BALANCE', X.ACNAME, A.PARTICULARS) PARTICULARS,
		CASE WHEN UPPER(A.PARTICULARS) <> 'OPENING BALANCE' THEN A.PARTICULARS ELSE '' END VTYPE, A.DRAMNT,A.CRAMNT,
		CONVERT(VARCHAR,CAST(ABS(A.BALANCE) AS MONEY),1) + CASE WHEN A.BALANCE >=0 THEN ' DR' ELSE ' CR' END BALANCE,
		A.B_ACID, A.DIVISION,'A' ORD,A.STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, A.A_ACID, '') A_ACID
		, IIF(UPPER(A.PARTICULARS) = 'OPENING BALANCE', 10, 0) XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, A.CCENTER, '') CCENTER FROM @LedgerTable A 		
		LEFT JOIN RMD_ACLIST X ON A.B_ACID = X.ACID

		UNION ALL
		--ITEM DETAIL 
		SELECT X.SNO,NULL [DATE],NULL MITI, NULL VNO, NULL REFBILL,NULL REFORDBILL, null TRNTIME
		, CAST(B.SNO AS VARCHAR(25)) + '. ' + LEFT(A.DESCA,30) + '  (@' + CAST(B.RATE AS VARCHAR(25)) + ' X ' + CAST(B.QUANTITY AS VARCHAR(25)) + ' = ' + CAST(B.AMOUNT AS VARCHAR(25)) +')' [PARTICULARS]
		,NULL VTYPE, NULL DRAMNT, NULL CRAMNT,NULL BALANCE,NULL B_ACID,X.DIVISION,'A1' ORD,X.STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, x.A_ACID, '') A_ACID, ISNULL(B.SNO,0) XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, x.CCENTER, '') CCENTER FROM @LedgerTable X INNER JOIN DBO.RMD_TRNPROD_FN(0,@FYID) B ON X.vchrno = B.VCHRNO AND 
		X.DIVISION = B.DIVISION INNER JOIN MENUITEM A ON B.MCODE = A.MCODE WHERE @SHOWPRODUCTDETAIL = 1

		UNION ALL
		--NARATION
		SELECT Sno,'' AS [DATE], '' MITI, ''  VNO,'' REFBILL,'' REFORDBILL, '' TRNTIME,'Nar :  ' +  X.naration + ' ' + case when x.cheque <> '' then x.Cheque else '' end  AS PARTICULAR
		, NULL VTYPE,	NULL AS DRAMNT,NULL AS CRAMNT,NULL BALANCE,NULL B_ACID,NULL AS DIVISION,'C' AS ORD,0 STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, x.A_ACID, '') A_ACID, 100 XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, x.CCENTER, '') CCENTER 
		FROM @LedgerTable X LEFT JOIN RMD_ACLIST Y ON X.A_ACID = Y.ACID WHERE ISNULL(X.NARATION,'') <> '' 
		GROUP BY IIF(@REPORTBYCOSTCENTER = 0, x.A_ACID, ''),IIF(@REPORTBYCOSTCENTER = 1, x.CCENTER, ''),X.naration,x.vchrno,sno,cheque,case when x.cheque <> '' then x.Cheque else '' end

		UNION ALL

		SELECT Sno,'' [DATE], '' MITI,'' VNO, '' REFBILL,'' REFORDBILL, '' TRNTIME,'Rmk :  ' + X.rmk  AS PARTICULAR, NULL VTYPE,NULL AS DRAMNT,NULL AS CRAMNT,NULL BALANCE,NULL B_ACID,NULL AS DIVISION,
		'D' AS ORD,0 STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, x.A_ACID, '') A_ACID, 100 XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, x.CCENTER, '') CCENTER 
		FROM @LedgerTable X LEFT JOIN RMD_ACLIST Y ON X.A_ACID = Y.ACID WHERE ISNULL(X.rmk,'') <> '' 
		GROUP BY IIF(@REPORTBYCOSTCENTER = 0, x.A_ACID, ''),IIF(@REPORTBYCOSTCENTER = 1, x.CCENTER, ''),X.rmk,x.vchrno,sno

		UNION ALL
		--BLANK
		SELECT MAX(SNO)+1,NULL AS [DATE], '' MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME,NULL AS PARTICULAR, NULL VTYPE,NULL DRAMNT, NULL CRAMNT,NULL BALANCE,NULL B_ACID,NULL AS DIVISION,
		'E' AS ORD,0 STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, A_ACID, '') A_ACID, 0 XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '') CCENTER 
		FROM @LedgerTable GROUP BY IIF(@REPORTBYCOSTCENTER = 0, A_ACID, ''),IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '')

		UNION ALL	
		--RUNNING TOTAL
			
		SELECT MAX(SNO)+2,NULL AS [DATE], NULL MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME,'RUNNING TOTAL >>' PARTICULAR, NULL VTYPE, SUM(DRAMNT) DRAMNT, SUM(CRAMNT) CRAMNT,
		CONVERT(VARCHAR,CAST(ABS(SUM(DRAMNT)- SUM(CRAMNT)) AS MONEY),1) + CASE WHEN SUM(DRAMNT)- SUM(CRAMNT) >=0 THEN ' DR' ELSE ' CR' END BALANCE,
		NULL B_ACID,NULL AS DIVISION,'F' AS ORD,0 STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, A_ACID, '') A_ACID, 1000 XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '') CCENTER 
		FROM @LedgerTable WHERE PARTICULARS NOT LIKE 'OPENING BALANCE' GROUP BY IIF(@REPORTBYCOSTCENTER = 0, A_ACID, ''),IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '')

		UNION ALL	
		--LEDGER TOTAL
		SELECT MAX(SNO)+3,NULL AS [DATE], NULL MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME,'LEDGER TOTAL >>' PARTICULAR, NULL VTYPE, SUM(DRAMNT) DRAMNT, SUM(CRAMNT) CRAMNT,
		CONVERT(VARCHAR,CAST(ABS(SUM(DRAMNT)- SUM(CRAMNT)) AS MONEY),1) + CASE WHEN SUM(DRAMNT)- SUM(CRAMNT) >=0 THEN ' DR' ELSE ' CR' END BALANCE,
		NULL B_ACID,NULL AS DIVISION,'F' AS ORD,0 STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, A_ACID, '') A_ACID, 1000 XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '') CCENTER 
		FROM @LedgerTable GROUP BY IIF(@REPORTBYCOSTCENTER = 0, A_ACID, ''),IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '')

		UNION ALL
		--BLANK
		SELECT MAX(SNO)+4,NULL AS [DATE], NULL MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME,NULL AS PARTICULAR, NULL VTYPE,NULL DRAMNT, NULL CRAMNT,NULL BALANCE,NULL B_ACID,NULL AS DIVISION
		,'G' AS ORD,0 STAMP
		, IIF(@REPORTBYCOSTCENTER = 0, A_ACID, '') A_ACID, 0 XSNO
		, IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '') CCENTER 
		FROM @LedgerTable WHERE @HASMULTILEDGER = 1 AND @InSingleLedger = 0  GROUP BY IIF(@REPORTBYCOSTCENTER = 0, A_ACID, ''),IIF(@REPORTBYCOSTCENTER = 1, CCENTER, '')


		UNION ALL
		--GRAND TOTAL OPENING
		SELECT MAX(SNO)+5,NULL AS [DATE], NULL MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME,'GRAND TOTAL OPENING >>' PARTICULAR, NULL VTYPE,SUM(DRAMNT) DRAMNT, SUM(CRAMNT) CRAMNT,
		NULL BALANCE,NULL B_ACID,NULL AS DIVISION,'H' AS ORD,0 STAMP, 'Z0000001' A_acid,1000 XSNO, 'Z0000001' CCENTER 
		FROM @LedgerTable WHERE PARTICULARS  = 'OPENING BALANCE' AND @HASMULTILEDGER = 1 AND @InSingleLedger = 0 

		UNION ALL
		--GRAND TOTAL RUNNING TOTAL
		SELECT MAX(SNO)+6,NULL AS [DATE],NULL MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME,'GRAND RUNNING TOTAL >>' PARTICULAR, NULL VTYPE,SUM(DRAMNT) DRAMNT, SUM(CRAMNT) CRAMNT,
		CONVERT(VARCHAR,CAST(ABS(SUM(DRAMNT)- SUM(CRAMNT)) AS MONEY),1) + CASE WHEN SUM(DRAMNT)- SUM(CRAMNT) >=0 THEN ' DR' ELSE ' CR' END BALANCE,
		NULL B_ACID,NULL AS DIVISION,'I' AS ORD,0 STAMP,'Z0000001' A_acid,1000 XSNO, 'Z0000001' CCENTER 
		FROM @LedgerTable WHERE PARTICULARS NOT LIKE 'OPENING BALANCE' AND @HASMULTILEDGER = 1 AND @InSingleLedger = 0 

		UNION ALL
		--GRAND TOTAL
		SELECT MAX(SNO)+7,NULL AS [DATE],NULL MITI,NULL VNO,NULL REFBILL,NULL REFORDBILL, null TRNTIME,'GRAND TOTAL >>' PARTICULAR, NULL VTYPE,SUM(DRAMNT) DRAMNT, SUM(CRAMNT) CRAMNT,
		CONVERT(VARCHAR,CAST(ABS(SUM(DRAMNT)- SUM(CRAMNT)) AS MONEY),1)  + CASE WHEN SUM(DRAMNT)- SUM(CRAMNT) >=0 THEN ' DR' ELSE ' CR' END BALANCE,
		NULL B_ACID,NULL AS DIVISION,'J' AS ORD,0 STAMP,'Z0000001' A_acid,1000 XSNO, 'Z0000001' CCENTER 
		FROM @LedgerTable WHERE @HASMULTILEDGER = 1 AND @InSingleLedger = 0 

	) A WHERE SNO IS NOT NULL ORDER BY A_ACID, CCENTER, SNO,ORD,STAMP,XSNO
END
