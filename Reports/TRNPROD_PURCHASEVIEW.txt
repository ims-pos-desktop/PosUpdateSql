CREATE OR ALTER VIEW [dbo].[TRNPROD_PURCHASEVIEW]
AS
SELECT A.VCHRNO,A.CHALANNO, A.DIVISION, A.MCODE,A.UNIT,B.DESCA,B.SUPCODE,B.MENUCODE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('PR','DN') THEN QUANTITY *-1 ELSE QUANTITY END AS QUANTITY,
REALQTY_IN,REALQTY,RATE,REALRATE,OPQTY,WAREHOUSE,PRATE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('PR','DN') THEN AMOUNT *-1 ELSE AMOUNT END AS AMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('PR','DN') THEN A.DISCOUNT *-1 ELSE A.DISCOUNT END AS DISCOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('PR','DN') THEN A.VAT *-1 ELSE A.VAT END AS VAT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('PR','DN') THEN
	(AMOUNT + A.VAT-A.DISCOUNT) *-1 ELSE (AMOUNT + A.VAT-A.DISCOUNT)  END AS NETAMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('PR','DN') THEN TAXABLE *-1 ELSE TAXABLE END AS TAXABLE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('PR','DN') THEN NONTAXABLE *-1 ELSE NONTAXABLE END AS NONTAXABLE,
B.PRATE_A,A.PHISCALID 
FROM RMD_TRNPROD A INNER JOIN MENUITEM B ON A.MCODE = B.MCODE


