CREATE OR ALTER   procedure [dbo].[sp_PurchaseRegister]
--DECLARE 
@DATE1 DATETIME,@DATE2 DATETIME,@DIVISION VARCHAR(10)='%', @FYID VARCHAR(10)=''
AS
--set @DATE1='18-sep-2014';set @DATE2='21-dec-2014'

IF @FYID='' SELECT @FYID= PhiscalID  FROM COMPANY
 
SELECT TRNDATE [Date],BSDATE [Miti],A.CHALANNO [Bill No],CASE WHEN TRNMODE = 'Cash' then C.ACNAME ELSE B.ACNAME END AS [Supplier Name],
CASE WHEN TRNMODE = 'Cash' then C.VATNO  ELSE B.VATNO  END AS [Supplier PAN],TAXABLE+NONTAXABLE+VATAMNT AS [Total Amount],NONTAXABLE [Non Taxable Amount],
CASE WHEN ISNULL(VMODE,1) <=1 THEN  TAXABLE else null end as[Purchase Amount] , CASE WHEN ISNULL(VMODE,0)<=1 THEN  VATAMNT ELSE NULL END AS [Tax Amount],
CASE WHEN ISNULL(VMODE,1) =2 THEN  TAXABLE else null end as[Import Purchase Amount] , CASE WHEN ISNULL(VMODE,1)=2 THEN  VATAMNT ELSE NULL END AS [Tax Amount],
CASE WHEN ISNULL(VMODE,1) =3 THEN  TAXABLE else null end as[Capitalized Purchase Amount] , CASE WHEN ISNULL(VMODE,1)=3 THEN  VATAMNT ELSE NULL END AS [Tax Amount]
FROM RMD_TRNMAIN A LEFT JOIN RMD_ACLIST B ON A.PARAC=B.ACID 
LEFT JOIN RMD_ACLIST C ON A.PARAC= C.ACID where VoucherType IN ('PI', 'CP') and isnull(a.status,0) = 0
and PhiscalID = @FYID  and DIVISION like @DIVISION and trndate between @DATE1 and @DATE2
ORDER BY TRNDATE,CAST(SUBSTRING(VNUM,3,LEN(VNUM)) AS NUMERIC)