CREATE OR ALTER VIEW [dbo].[TRNPROD_VIEW_SREPORT]
AS

SELECT A.VCHRNO,A.CHALANNO, A.DIVISION, A.MCODE,A.UNIT,B.MENUCODE,B.DESCA,B.BASEUNIT,B.SUPCODE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN QUANTITY ELSE QUANTITY *-1 END AS QUANTITY,
REALQTY_IN,REALQTY,RATE,REALRATE,OPQTY,WAREHOUSE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN AMOUNT ELSE AMOUNT *-1 END AS AMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN A.DISCOUNT ELSE A.DISCOUNT *-1 END AS DISCOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN A.VAT ELSE A.VAT *-1 END AS VAT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN AMOUNT + A.VAT ELSE (AMOUNT + A.VAT) *-1 END AS GROSSAMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN AMOUNT + A.VAT-A.DISCOUNT ELSE (AMOUNT + A.VAT-A.DISCOUNT) *-1 END AS NETAMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN TAXABLE ELSE TAXABLE *-1 END AS TAXABLE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN NONTAXABLE ELSE NONTAXABLE *-1 END AS NONTAXABLE,
CASE WHEN VRATE > 0 THEN
	CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN VRATE ELSE VRATE *-1 END
ELSE 
	CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN A.VAT ELSE A.VAT *-1 END END AS VRATE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SI','TI','IC') THEN SERVICETAX ELSE SERVICETAX *-1 END AS SCHARGE,
PhiscalID,A.LOYALTY
FROM RMD_SALESPROD A INNER JOIN MENUITEM B ON A.MCODE = B.MCODE WHERE LEFT(A.VCHRNO,2) IN ('SI','SR','TI','CN','IC','IR','RE')