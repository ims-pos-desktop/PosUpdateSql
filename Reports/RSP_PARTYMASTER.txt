CREATE OR ALTER PROC RSP_PARTYMASTER
@OPT_TREE tinyint = 0,                                          --NonTree:0,Tree:1
@DIVISION VARCHAR(3)= '%'
AS

	IF OBJECT_ID('tempdb..#ACLIST') is not null drop table #ACLIST
SELECT ACID, CASE WHEN PTYPE = 'C' THEN 'CUSTOMER' ELSE 'VENDOR' END PartyType, 
ACNAME PartyName, ACCODE PartyCode, VATNO, ADDRESS, PHONE, EMAIL, CRLIMIT CreditLimit, CRPERIOD CreditPeriod, DDA_NO, NCDA_NO, ISACTIVE,TYPE INTO #ACLIST FROM RMD_ACLIST

IF @OPT_TREE = 1
	SELECT T.TYPE, A.* FROM DBO.TreeExpandfunction_Account('PA','Party List',0,0,0,1) T LEFT JOIN #ACLIST A ON T.ACID = A.ACID
ELSE 
	SELECT A.*,B.[A/C MAIN GROUP],	B.[A/C GROUP A]	,B.[A/C GROUP B],	B.[A/C GROUP C] FROM #ACLIST A LEFT JOIN VW_PARTY_HIERARCHY B ON A.ACID=B.ACID WHERE 
	A.ACID LIKE 'PA%'  AND TYPE='A' ORDER BY PartyType, PartyName 
