CREATE OR ALTER PROC RSP_REQUISITION_RAW
@DATE1 DATETIME,
@DATE2 DATETIME,
@FDIVISION VARCHAR(3) = '%',
@TDIVISION VARCHAR(3) = '%'
AS
SELECT OM.TDate, D.NAME [From Branch], TD.NAME [To Branch], OM.ReqId [Entry No], OM.TUSER
, IH.[Main Group], IH.[Main Category], IH.[Sub Category], IH.[Super Category], MI.MENUCODE [Item Code], MI.DESCA [Item Name]
, OP.BCODE Barcode, OP.Unit, OP.Quantity, MI.PRATE_A Rate
FROM TBL_REQUISITION OM JOIN TBL_REQUISITION_DETAILS OP ON OM.ReqId = OP.ReqId
JOIN MENUITEM MI ON MI.MCODE = OP.MCODE
JOIN vwItemHeirarchy IH ON MI.MCODE = IH.MCODE
JOIN DIVISION D ON OM.FromDivision = D.INITIAL
JOIN DIVISION TD ON OM.ToDivision = TD.INITIAL
WHERE OM.FromDivision LIKE @FDIVISION 
AND OM.ToDivision LIKE @TDIVISION
AND OM.TDATE BETWEEN @DATE1 AND @DATE2
ORDER BY OM.TDate, D.NAME, OM.ReqId