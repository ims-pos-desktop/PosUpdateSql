CREATE OR ALTER   PROC [dbo].[RSP_CONSOLIDATEDORDER_RAW]
@DATE1 DATETIME,
@DATE2 DATETIME,
@FDIVISION VARCHAR(3) = '%',
@TDIVISION VARCHAR(3) = '%'
AS
SELECT OM.TRNDATE, OM.BSDATE,'Sales Order' OrderType, D.NAME Branch, OM.VCHRNO, A.ACNAME PARTY,OM.TRNUSER
, IH.[Main Group], IH.[Main Category], IH.[Sub Category], IH.[Super Category], MI.MENUCODE [Item Code], MI.DESCA [Item Name]
, OP.BC Barcode, OP.ALTUNIT Unit, OP.ALTQTY Quantity, OP.ALTRATE Rate, OP.AMOUNT
FROM RMD_ORDERMAIN OM JOIN RMD_ORDERPROD OP ON OM.VCHRNO = OP.VCHRNO
JOIN MENUITEM MI ON MI.MCODE = OP.MCODE
JOIN vwItemHeirarchy IH ON MI.MCODE = IH.MCODE
JOIN DIVISION D ON OM.DIVISION = D.INITIAL
LEFT JOIN RMD_ACLIST A ON OM.TRNAC = A.ACID
WHERE OM.VCHRNO LIKE 'SO%' AND OM.DIVISION LIKE @TDIVISION AND OM.TRNDATE BETWEEN @DATE1 AND @DATE2
UNION ALL
SELECT OM.TDate, NULL, 'Requisition', D.NAME, CONVERT(VARCHAR(25), OM.ReqId), D.NAME, OM.TUSER
, IH.[Main Group], IH.[Main Category], IH.[Sub Category], IH.[Super Category], MI.MENUCODE [Item Code], MI.DESCA [Item Name]
, OP.BCODE, OP.Unit, OP.Quantity, MI.PRATE_A, OP.Quantity * MI.PRATE_A
FROM TBL_REQUISITION OM JOIN TBL_REQUISITION_DETAILS OP ON OM.ReqId = OP.ReqId
JOIN MENUITEM MI ON MI.MCODE = OP.MCODE
JOIN vwItemHeirarchy IH ON MI.MCODE = IH.MCODE
JOIN DIVISION D ON OM.FromDivision = D.INITIAL
JOIN DIVISION TD ON OM.ToDivision = TD.INITIAL
WHERE OM.FromDivision LIKE @FDIVISION 
AND OM.ToDivision LIKE @TDIVISION
AND OM.TDATE BETWEEN @DATE1 AND @DATE2
ORDER BY TRNDATE, NAME, VCHRNO

