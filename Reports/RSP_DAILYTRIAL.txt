CREATE OR ALTER PROC RSP_DAILYTRIAL
@DATE1 DATETIME,
@DATE2 DATETIME,
@DIVISION VARCHAR(3) = '%',
@USER VARCHAR(50) = '%'
AS
if OBJECT_ID('Tempdb..#REPDATA') is not null drop table #REPDATA

SELECT TRNDATE, BSDATE, A.ACTYPE, A.ACCODE, A.ACNAME, SUM(T.DRAMNT) Dr, SUM(T.CRAMNT) Cr 
INTO #REPDATA FROM RMD_TRNMAIN M 
JOIN RMD_TRNTRAN T ON M.VCHRNO = T.VCHRNO AND M.DIVISION = T.DIVISION AND M.PHISCALID = T.PHISCALID
JOIN RMD_ACLIST A ON T.A_ACID = A.ACID
WHERE M.TRNDATE BETWEEN @DATE1 AND @DATE2 AND M.DIVISION LIKE @DIVISION AND M.TRNUSER LIKE @USER
GROUP BY TRNDATE, TRNAC, BSDATE, A.ACCODE, A.ACNAME, A.ACTYPE
ORDER BY TRNDATE, A.ACTYPE

SELECT DISTINCT CONVERT(VARCHAR(10), TRNDATE, 101) ACCODE, BSDATE ACNAME, 'G' TYPE, 1 SECTION, NULL DEBIT, NULL CREDIT, TRNDATE FROM #REPDATA
UNION ALL
SELECT ISNULL(ACCODE, ''), ACNAME, 'A', 2, Dr , Cr, TRNDATE FROM #REPDATA
UNION ALL
SELECT '', 'TOTAL >>', 'G', 3, SUM(Dr), SUM(Cr), TRNDATE FROM #REPDATA GROUP BY TRNDATE
UNION ALL
SELECT DISTINCT '', '', '', 4, NULL , NULL,  TRNDATE FROM #REPDATA
ORDER BY TRNDATE, SECTION
DROP TABLE #REPDATA