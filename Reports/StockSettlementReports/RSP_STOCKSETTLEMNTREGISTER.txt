CREATE OR ALTER PROC  [dbo].[RSP_STOCKSETTLEMNTREGISTER]
	@DATE1 DATETIME,
	@DATE2 DATETIME,
	@SETTLEMENTMODE varchar(25) = '%',
	@DIVISION VARCHAR(15) = '%'
AS
SELECT * FROM
(	
	SELECT A.TRNDATE, A.BSDATE, A.VCHRNO,A.TRNMODE, NULL AS UNIT, NULL AS RATE, NULL AS INQTY, NULL AS OUTQTY, NULL AS AMOUNT, A.REMARKS,
	'A' AS FLAG,A.VCHRNO AS VNO,TRNDATE AS TDATE  FROM RMD_TRNMAIN A WHERE VCHRNO LIKE 'DM%' AND (TRNDATE>=@DATE1 AND TRNDATE<= @DATE2) AND TRNMODE LIKE @SETTLEMENTMODE AND DIVISION LIKE @DIVISION
	UNION ALL
	SELECT NULL, NULL, B.MENUCODE, B.DESCA,B.BASEUNIT,A.REALRATE,A.REALQTY,A.REALQTY_IN,A.AMOUNT,A.WAREHOUSE,'B' AS FLAG,A.VCHRNO AS VNO,TRNDATE AS TDATE
	FROM RMD_TRNPROD A, MENUITEM B, RMD_TRNMAIN C WHERE A.MCODE = B.MCODE AND A.VCHRNO = C.VCHRNO AND A.DIVISION = C.DIVISION AND A.VCHRNO LIKE 'DM%'
	AND (TRNDATE>=@DATE1 AND TRNDATE<= @DATE2) AND TRNMODE LIKE @SETTLEMENTMODE  AND A.DIVISION LIKE @DIVISION
	UNION ALL
	SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,
	'C' AS FLAG,A.VCHRNO AS VNO,TRNDATE AS TDATE  FROM RMD_TRNMAIN A WHERE VCHRNO LIKE 'DM%' AND (TRNDATE>=@DATE1 AND TRNDATE<= @DATE2) AND TRNMODE LIKE @SETTLEMENTMODE AND DIVISION LIKE @DIVISION

) AS A ORDER BY VNO, FLAG,TDATE