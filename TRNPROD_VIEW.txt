CREATE OR ALTER VIEW [dbo].[TRNPROD_VIEW]
AS

SELECT A.VCHRNO,A.CHALANNO, A.DIVISION, A.MCODE,A.UNIT,B.DESCA,B.SUPCODE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SR','CN','PR','IR','RE') THEN QUANTITY *-1 ELSE QUANTITY END AS QUANTITY,
REALQTY_IN,REALQTY,RATE,REALRATE,OPQTY,WAREHOUSE,PRATE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SR','CN','PR','IR','RE') THEN AMOUNT *-1 ELSE AMOUNT END AS AMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('CN','SR','PR','IR','RE') THEN A.DISCOUNT *-1 ELSE A.DISCOUNT END AS DISCOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('CN','SR','PR','IR','RE') THEN A.VAT *-1 ELSE A.VAT END AS VAT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SR','CN','PR','IR','RE') THEN
	CASE WHEN LEFT(A.VCHRNO,2) IN ('SR') THEN AMOUNT *-1 ELSE (AMOUNT + A.VAT) *-1 END
ELSE
	CASE WHEN LEFT(A.VCHRNO,2) IN ('SI') THEN AMOUNT ELSE (AMOUNT + A.VAT) END END AS GROSSAMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SR','CN','PR','IR','RE') THEN
	CASE WHEN LEFT(A.VCHRNO,2) IN ('SR') THEN (AMOUNT-A.DISCOUNT) *-1 ELSE (AMOUNT + A.VAT-A.DISCOUNT) *-1 END	
ELSE
	CASE WHEN LEFT(A.VCHRNO,2) IN ('SI') THEN AMOUNT-A.DISCOUNT ELSE AMOUNT + A.VAT-A.DISCOUNT END END AS NETAMOUNT,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SR','CN','PR','IR','RE') THEN TAXABLE *-1 ELSE TAXABLE END AS TAXABLE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SR','CN','PR','IR','RE') THEN NONTAXABLE *-1 ELSE NONTAXABLE END AS NONTAXABLE,
CASE WHEN LEFT(A.VCHRNO,2) IN ('SR','CN','PR','IR','RE') THEN VRATE *-1 ELSE VRATE END AS VRATE,
B.PRATE_A,A.PHISCALID 
FROM RMD_TRNPROD A INNER JOIN MENUITEM B ON A.MCODE = B.MCODE