CREATE OR ALTER   FUNCTION [dbo].[RMD_TRNPROD_FN](@GRNWISE TINYINT)
RETURNS @RMD_TRNPROD TABLE (VCHRNO varchar(25) NOT NULL, CHALANNO varchar(15), DIVISION char(3) NOT NULL, MCODE varchar(25) NOT NULL, UNIT varchar(20), Quantity numeric(18, 3),
							RealQty numeric(18, 3), AltQty numeric(18, 3), RATE decimal(20, 12), AMOUNT numeric(20, 12), DISCOUNT numeric(20, 12), VAT numeric(20, 12), 
							REALRATE decimal(20, 12), EXPORT tinyint, IDIS varchar(100), OPQTY numeric(18, 3), REALQTY_IN numeric(18, 3), ALTQTY_IN numeric(18, 3), 
							WAREHOUSE varchar(50), REFBILLQTY numeric(18, 3), SPRICE numeric(22, 12), EXPDATE datetime NULL, REFOPBILL numeric(18, 0), ALTUNIT varchar(20), 
							TRNAC varchar(25), PRATE numeric(18, 2), VRATE numeric(20, 12), ALTRATE decimal(20, 12), VPRATE numeric(15, 2), VSRATE numeric(15, 2), 
							TAXABLE numeric(20, 12), NONTAXABLE numeric(20, 12), INVRATE numeric(18, 8), EXRATE numeric(18, 2), NCRATE numeric(18, 2), CRATE numeric(18, 6), 
							SNO int NULL, CUSTOM numeric(18, 6), [WEIGHT] numeric(18, 6), DRATE numeric(18, 6), CARTON numeric(18, 6), INVOICENO varchar(50), ISSUENO varchar(50), 
							BC varchar(50), GENERIC varchar(50), BATCH varchar(50), MFGDATE datetime NULL, MANUFACTURER varchar(100), SERVICETAX numeric(20, 12), 
							BCODEID numeric(18, 0), VoucherType varchar(2) NOT NULL, SALESMANID int NULL, PhiscalID varchar(20), STAMP float NULL, ITEMDESC varchar(200), 
							DNID numeric(18, 0), PROMOTION numeric(18, 8), LOYALTY numeric(18, 8), INDDISCOUNT numeric(18, 8), FLATDISCOUNT numeric(18, 8), 
							NETAMOUNT numeric(18, 8), ADDTIONALROW numeric(18, 8), COSTCENTER varchar(100), ISVAT tinyint, PRODCONDITION varchar(20), PRODMODE varchar(20), 
							ITEMTYPE varchar(20), RECEIVEDTYPE varchar(20), REMARKS varchar(255))
AS
BEGIN
						INSERT INTO @RMD_TRNPROD
						SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, 
						CASE WHEN REALRATE = 0 THEN RATE ELSE REALRATE END REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                    EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                    ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                    FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          
						  FROM            dbo.ABBPROD 
                          
                        
                         
                   
					UNION ALL
					SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, 
													CASE WHEN VOUCHERTYPE = 'CN' THEN 0 ELSE RealQty END RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, 
													CASE WHEN REALRATE = 0 THEN RATE ELSE REALRATE END REALRATE, EXPORT, IDIS, OPQTY, 
													CASE WHEN VOUCHERTYPE = 'CN' AND QUANTITY <> REALQTY_IN THEN QUANTITY ELSE REALQTY_IN END REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                    EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                    ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                    FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          
						  FROM            dbo.TRNPROD 
                          UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.INVPROD
                          UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.PURPROD WHERE @GRNWISE = 0
                          UNION ALL 
						  SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.GRNPROD WHERE @GRNWISE = 1 AND VoucherType = 'GR'
                          UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.ACCPROD
						  UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.OPAPROD
						  UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.OPPROD
						  RETURN
						  END
