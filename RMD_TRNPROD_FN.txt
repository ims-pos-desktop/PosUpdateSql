
CREATE OR ALTER FUNCTION [dbo].[RMD_TRNPROD_FN](@GRNWISE TINYINT)
RETURNS @RMD_TRNPROD TABLE ( VCHRNO VARCHAR(25), CHALANNO VARCHAR(50), DIVISION CHAR(3), MCODE VARCHAR(100), UNIT VARCHAR(10), Quantity NUMERIC(18,3), RealQty NUMERIC(18,3), AltQty NUMERIC(18,3), RATE NUMERIC(20,12), AMOUNT NUMERIC(20,12), DISCOUNT NUMERIC(20,12), VAT NUMERIC(20,12), REALRATE NUMERIC(28,12), EXPORT TINYINT, IDIS VARCHAR(100), OPQTY NUMERIC(18,3), REALQTY_IN NUMERIC(18,3), ALTQTY_IN NUMERIC(18,3), WAREHOUSE VARCHAR(50), REFBILLQTY NUMERIC(18,3), SPRICE NUMERIC(22,12), 
                                                   EXPDATE DATETIME, REFOPBILL NUMERIC(18,0), ALTUNIT VARCHAR(15), TRNAC VARCHAR(25), PRATE NUMERIC(20,12), VRATE NUMERIC(20, 12), ALTRATE NUMERIC(20, 12), VPRATE NUMERIC(20, 12), VSRATE NUMERIC(20, 12), TAXABLE NUMERIC(20, 12), NONTAXABLE NUMERIC(20, 12), INVRATE NUMERIC(20, 12), EXRATE NUMERIC(20, 12), NCRATE NUMERIC(20, 12), CRATE NUMERIC(20, 12), SNO INT, CUSTOM NUMERIC(20, 12), WEIGHT NUMERIC(20, 12), DRATE NUMERIC(20, 12), CARTON NUMERIC(20, 12), INVOICENO VARCHAR(50), 
                                                   ISSUENO VARCHAR(50), BC VARCHAR(50), GENERIC VARCHAR(50), BATCH VARCHAR(50), MFGDATE DATETIME, MANUFACTURER VARCHAR(100), SERVICETAX NUMERIC(20, 12), BCODEID NUMERIC(20, 0), VoucherType VARCHAR(2), SALESMANID INT, PhiscalID VARCHAR(20), STAMP FLOAT, ITEMDESC VARCHAR(500), DNID NUMERIC(20, 0), COSTCENTER VARCHAR(100), PROMOTION NUMERIC(20, 12), LOYALTY NUMERIC(20, 12), INDDISCOUNT NUMERIC(20, 12), 
                                                   FLATDISCOUNT NUMERIC(20, 12), NETAMOUNT NUMERIC(20, 12), ADDTIONALROW NUMERIC(20, 12), ISVAT TINYINT, PRODCONDITION VARCHAR(20), PRODMODE VARCHAR(20), ITEMTYPE VARCHAR(20), RECEIVEDTYPE VARCHAR(20), REMARKS VARCHAR(255))
AS
BEGIN
						INSERT INTO @RMD_TRNPROD
						SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, 
						CASE WHEN REALRATE = 0 THEN RATE ELSE REALRATE END REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                    EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                    ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                    FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          
						  FROM            dbo.ABBPROD 
                          
                        
                         
                   
					UNION ALL
					SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, 
													CASE WHEN VOUCHERTYPE = 'CN' THEN 0 ELSE RealQty END RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, 
													CASE WHEN REALRATE = 0 THEN RATE ELSE REALRATE END REALRATE, EXPORT, IDIS, OPQTY, 
													CASE WHEN VOUCHERTYPE = 'CN' AND QUANTITY <> REALQTY_IN THEN QUANTITY ELSE REALQTY_IN END REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                    EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                    ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                    FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          
						  FROM            dbo.TRNPROD 
                          UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.INVPROD
                          UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.PURPROD WHERE @GRNWISE = 0
                          UNION ALL 
						  SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.GRNPROD WHERE @GRNWISE = 1 AND VoucherType = 'GR'
                          UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.ACCPROD
						  UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.OPAPROD
						  UNION ALL
                          SELECT        VCHRNO, CHALANNO, DIVISION, MCODE, UNIT, Quantity, RealQty, AltQty, RATE, AMOUNT, DISCOUNT, VAT, REALRATE, EXPORT, IDIS, OPQTY, REALQTY_IN, ALTQTY_IN, WAREHOUSE, REFBILLQTY, SPRICE, 
                                                   EXPDATE, REFOPBILL, ALTUNIT, TRNAC, PRATE, VRATE, ALTRATE, VPRATE, VSRATE, TAXABLE, NONTAXABLE, INVRATE, EXRATE, NCRATE, CRATE, SNO, CUSTOM, WEIGHT, DRATE, CARTON, INVOICENO, 
                                                   ISSUENO, BC, GENERIC, BATCH, MFGDATE, MANUFACTURER, SERVICETAX, BCODEID, VoucherType, SALESMANID, PhiscalID, STAMP, ITEMDESC, DNID, COSTCENTER, PROMOTION, LOYALTY, INDDISCOUNT, 
                                                   FLATDISCOUNT, NETAMOUNT, ADDTIONALROW, ISVAT, PRODCONDITION, PRODMODE, ITEMTYPE, RECEIVEDTYPE, REMARKS
                          FROM            dbo.OPPROD
						  RETURN
						  END
