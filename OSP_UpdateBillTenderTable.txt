CREATE OR ALTER PROC OSP_UpdateBillTenderTable
AS
DECLARE @TRNMODE VARCHAR(50)
IF OBJECT_ID('TEMPDB..#TRNMODE') is not null drop table #TRNMODE
select distinct IIF(ISNULL(T.TRNMODE,'')='','Others',T.TRNMODE) TRNMODE into #TRNMODE from SALES_TRNMAIN M JOIN RMD_BILLTENDER T ON M.VCHRNO = T.VCHRNO 

BEGIN

	DECLARE CUR_TEST CURSOR FAST_FORWARD FOR
	SELECT QUOTENAME(T.TRNMODE) FROM #TRNMODE T LEFT JOIN 
	(
		SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'tblBillTender'
	) S ON T.trnmode = S.COLUMN_NAME
	WHERE S.COLUMN_NAME IS NULL
	ORDER BY T.TRNMODE
 
	OPEN CUR_TEST
	FETCH NEXT FROM CUR_TEST INTO @TRNMODE
 
	WHILE @@FETCH_STATUS = 0
	BEGIN
	   EXECUTE('ALTER TABLE tblBillTender ADD ' + @TRNMODE + ' NUMERIC(18,2)')

	   FETCH NEXT FROM CUR_TEST INTO @TRNMODE
	END
	CLOSE CUR_TEST
	DEALLOCATE CUR_TEST
END